{% extends 'base.html' %}
{% block title %}
    Game
{% endblock %}
{% block stylesheet %}
    {{ block.super }}
    {% load static %}
    <link rel="stylesheet" href='{% static "bootstrap/css/bootstrap.min.css" %}'>
    <link rel="stylesheet" href='{% static "fonts/simple-line-icons.min.css" %}'>
    <link href="{% static 'css/show-game.css' %}" rel="stylesheet"/>
{% endblock %}

{% block content %}

    <!-- MODAL-->
    <div class="modal fade" id="restartModalCenter" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">{{ game.title }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    Are you sure you want to restart?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-outline"
                            style="background-color: #F58310; color: white; border-color: #F58310;"
                            onclick="window.location.href='{% url 'restart_game' game.id %}'">Restart
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS %}success
        {% elif  message.level == DEFAULT_MESSAGE_LEVELS.ERROR %}danger{% else %}secondary{% endif %}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <span class="up icon-arrow-up2"
          style="display: none; z-index:20;padding: 20px; background-color: white; cursor: pointer; position: fixed; bottom: 10px; right: 5px; border-radius: 30px">
    <i class="fa fa-chevron-up"></i>
    </span>
    <section>
        <nav id="barra" class="navbar navbar-expand-lg navbar-light"
             style="background-color: white; border-radius: 10px; height: 30px;">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#loc"><i class="fa fa-map-marked-alt"></i> Location</a>
                </li>
                {% if show_treasures %}
                    <li class="nav-item">
                        <a class="nav-link" href="#par"><i class="fa fa-users"></i> Players</a>
                    </li>
                {% endif %}
                <li class="nav-item">
                    <a class="nav-link" href="#tre"><i class="fa fa-gem"></i> Treasures</a>
                </li>
            </ul>
        </nav>
    </section>
    <br>

    <div class="container-fluid">

        <section class="bg-white" style="padding-top: 25px;padding-bottom: 25px; border-radius: 10px;">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6">
                        <img class="img-fluid" src="{{ game.picture }}">
                    </div>
                    <div class="col-lg-6">
                        <div class="text-right">
                            <button class="btn" id="compartirButton"
                                    onclick="share('http://localhost:8000/api/games/{{ game.id }}')"
                                    data-toggle="tooltip" data-placement="left" title="Share it with Twitter!"><i
                                    class="fab fa-twitter" style="color: dodgerblue"></i>
                            </button>
                        </div>
                        <h1 class="text-dark"
                            style="padding-left: 15px;padding-right: 15px;">{{ game.title }}</h1>
                        <hr>
                        <p><a style="font-weight: bold">Creator:</a>
                            <a style="color: #15073C">{{ game.creator.name }}</a>
                        </p>
                        <label style="font-weight: bold">Description</label>
                        <p>{{ game.description }}</p>
                        <hr>
                        {% if game.winner %}
                            <h4> The winner is {{ game.winner.name }}!</h4>
                        {% elif not game.winner %}
                            <h4>No winner yet</h4>
                        {% endif %}

                        {% if game.active %}
                            <p>Active</p>
                            {% if game.restart_date %}
                                <p>The game was restored on {{ game.restart_date }}</p>
                            {% endif %}

                            {% if user.id == game.creator.id %}
                                <button class="btn" data-toggle="modal" data-target="#restartModalCenter"
                                        id="btnSignup">
                                    Restart <i data-toggle="tooltip" data-placement="top"
                                               class="fa fa-redo-alt"></i>
                                </button>
                            {% elif canNotSignup %}
                                <hr>
                                <p style="font-weight: bold">
                                    You are already subscribed to this game.
                                </p>
                            {% else %}
                                <hr>
                                <button class="btn" data-toggle="modal" id="btnSignup"
                                        onclick="window.location.href='{% url 'signup_game' game.id %}'">
                                    Sign up <i data-toggle="tooltip" data-placement="top"
                                               class="fa fa-plus-square" style="color:whitesmoke;"></i>
                                </button>
                            {% endif %}
                        {% else %}
                            <p>Inactive</p>
                        {% endif %}

                    </div>
                </div>
            </div>

        </section>


        <br/>

        <div id="loc" class="card">
            <div class="card-body" style="height: auto;">
                <div class="form-map">
                    <p>{{ game.location }}</p>
                    <div id="mapId">
                        {{ maps|safe }}
                    </div>
                </div>

            </div>
        </div>
        <br/>
        {% if show_treasures %}
            <div id="par" class="card">
                <div class="card-header">
                    <i class="fa fa-users"></i> Players
                </div>
                <div class="card-body" style="height: auto;">
                    {% for player in game.players %}
                        <p>{{ player.name }} - {{ player.email }}</p>
                    {% endfor %}
                </div>
            </div>
        {% endif %}
        <br/>
        <div id="tre">
            <div class="row d-flex d-sm-flex justify-content-rigth justify-content-sm-rigth">
                {% for treasure in treasures %}
                    <div class="col-md-3" style="width: 300px;height: 500px">
                        <div class="card cards-shadown cards-hover" data-aos="slide-right" data-aos-duration="950">
                            {% if show_treasures %}
                                <div class="card-header" style="color: dimgrey">
                                    <i class="fas fa-globe-africa"></i> {{ treasure.coordinates }}
                                </div>
                            {% endif %}
                            {% if canNotSignup or show_treasures %}
                                <a {% if game.active %}href="{% url 'treasure' treasure.id game.creator.id %}" {% endif %}>
                                    <img class="card-img-top" src="{{ treasure.picture }}"
                                         alt="Card image cap">
                                </a>
                            {% else %}
                                <img class="card-img-top" src="{{ treasure.picture }}"
                                     alt="Card image cap">
                            {% endif %}
                            <div class="card-body">
                                <label style="font-weight: bold">Clue </label>
                                <p>{{ treasure.clue }}
                                </p>
                            </div>
                        </div>
                        <br><br>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>


    <br/>
    </div>
{% endblock %}
{% block javascripts %}
    {{ block.super }}
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src='{% static "js/jquery.min.js" %}'></script>
    <script src='{% static "bootstrap/js/bootstrap.min.js" %}'></script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })

        function share(text) {
            var input = document.body.appendChild(document.createElement("input"));
            input.parue = text;
            input.focus();
            input.select();
            document.execCommand('copy');
            input.parentNode.removeChild(input);

            window.open("https://twitter.com/intent/tweet?text=What's up my followers! See what treasure hunting I have found on TreasureHunt! \r\n" + text, "_blank")
        }

        $('.up').click(function () {
            $('body, html').animate({
                scrollTop: '0px'
            }, 300);
        });

        $(window).scroll(function () {
            if ($(this).scrollTop() > 0) {
                $('.up').slideDown(300);
            } else {
                $('.up').slideUp(300);
            }
        });

    </script>
{% endblock %}